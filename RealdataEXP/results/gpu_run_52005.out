============================================================
作业开始时间: Sun Aug  3 12:56:07 HKT 2025
作业ID: 52005
节点名称: gpu01
GPU数量: 1
============================================================
加载CUDA模块...
============================================================
CUDA环境检测
============================================================
检查GPU状态...
Sun Aug  3 12:56:07 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 565.57.01              Driver Version: 565.57.01      CUDA Version: 12.7     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A30                     On  |   00000000:4A:00.0 Off |                    0 |
| N/A   32C    P0             30W /  165W |       1MiB /  24576MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
✅ GPU检测成功

检查CUDA版本...
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2024 NVIDIA Corporation
Built on Tue_Feb_27_16:19:38_PST_2024
Cuda compilation tools, release 12.4, V12.4.99
Build cuda_12.4.r12.4/compiler.33961263_0
✅ CUDA工具包可用

检查Python和PyTorch环境...
============================================================
PyTorch和CUDA环境检查
============================================================
Python版本: 3.9.21 (main, Dec  5 2024, 00:00:00) 
[GCC 11.5.0 20240719 (Red Hat 11.5.0-2)]
PyTorch版本: 2.7.1+cu126
NumPy版本: 2.0.2

CUDA可用: True
CUDA版本: 12.6
cuDNN版本: 90501
GPU数量: 1
GPU 0: NVIDIA A30
  内存容量: 23.6 GB

当前设备: 0
设备名称: NVIDIA A30

进行GPU计算测试...
✓ GPU计算测试通过
GPU内存使用: 20.0 MB
GPU内存缓存: 20.0 MB

其他依赖库检查:
✓ pandas: 2.3.1
✓ scikit-learn: 1.6.1
✓ PyYAML 已安装
============================================================

============================================================
环境检测完成 - 所有检查通过！
============================================================
批处理模式：自动开始实验...

============================================================
开始运行实验
============================================================
使用配置文件: configs/experiment.yaml
设备配置: auto (将自动选择GPU)
SLURM作业分配后的GPU状态：
Sun Aug  3 12:56:13 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 565.57.01              Driver Version: 565.57.01      CUDA Version: 12.7     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A30                     On  |   00000000:4A:00.0 Off |                    0 |
| N/A   32C    P0             30W /  165W |       1MiB /  24576MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+

开始运行Global Mode GPU实验...
预期运行时间：约60-90分钟

2025-08-03 12:56:16 - root - INFO - ============================================================
2025-08-03 12:56:16 - root - INFO - RealdataEXP 实验框架启动
2025-08-03 12:56:16 - root - INFO - ============================================================
2025-08-03 12:56:16 - root - INFO - 实验模式: global
2025-08-03 12:56:16 - root - INFO - 实验目录: /home/zhixuanhu/IEDA_WeightedTraining/RealdataEXP/results/20250803_1256
2025-08-03 12:56:16 - root - INFO - 配置文件: /home/zhixuanhu/IEDA_WeightedTraining/RealdataEXP/configs/experiment.yaml
2025-08-03 12:56:16 - root - INFO - [模式选择] 运行Global模式实验
2025-08-03 12:56:16 - libs.modes.global_mode - INFO - [Global模式] 初始化完成，设备: cuda
2025-08-03 12:56:16 - libs.modes.global_mode - INFO - [Global模式] 开始运行完整实验...
2025-08-03 12:56:16 - libs.modes.global_mode - INFO - [Global模式] 开始数据加载和准备...
2025-08-03 12:56:16 - libs.data.data_loader - INFO - [数据准备] 开始数据加载和准备流程...
2025-08-03 12:56:16 - libs.data.data_loader - INFO - [数据加载] 开始加载所有数据文件...
2025-08-03 12:56:16 - libs.data.data_loader - INFO - [数据加载] (1/6) 正在加载 log_random: data/log_random_4_22_to_5_08_pure.csv
2025-08-03 12:56:17 - libs.data.data_loader - INFO - [数据加载] log_random 加载完成，形状: (1186059, 19)
2025-08-03 12:56:17 - libs.data.data_loader - INFO - [数据加载] (2/6) 正在加载 log_standard_early: data/log_standard_4_08_to_4_21_pure.csv
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] log_standard_early 加载完成，形状: (1141112, 19)
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] (3/6) 正在加载 log_standard_late: data/log_standard_4_22_to_5_08_pure.csv
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] log_standard_late 加载完成，形状: (295497, 19)
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] (4/6) 正在加载 user_features: data/user_features_pure.csv
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] user_features 加载完成，形状: (27285, 31)
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] (5/6) 正在加载 video_basic: data/video_features_basic_pure.csv
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] video_basic 加载完成，形状: (7583, 12)
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] (6/6) 正在加载 video_statistic: data/video_features_statistic_pure.csv
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] video_statistic 加载完成，形状: (7583, 52)
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据加载] 所有数据文件加载完成
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据合并] 合并多个日志文件...
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [数据合并] 合并后日志数据形状: (2622668, 19)
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [特征合并] 开始合并用户和视频特征...
2025-08-03 12:56:18 - libs.data.data_loader - INFO - [特征合并] 合并用户特征后形状: (2622668, 49)
2025-08-03 12:56:19 - libs.data.data_loader - INFO - [特征合并] 合并视频基础特征后形状: (2622668, 60)
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [特征合并] 合并视频统计特征后形状: (2622668, 111)
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [特征合并] 特征合并完成
2025-08-03 12:56:21 - libs.data.cache_manager - INFO - [缓存] 数据已加载: user_video_lists
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [缓存] 从缓存加载用户-视频交互列表
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [用户划分] 开始划分用户，验证集比例: 0.2
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [用户划分] 训练用户数: 21828, 验证用户数: 5457
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [标记位] 添加mask和used标记位...
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [标记位] mask=1的样本数: 532462/2622668 (20.30%)
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [标记位] 标记位添加完成
2025-08-03 12:56:21 - libs.data.data_loader - INFO - [数据准备] 数据准备流程完成
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 总样本数: 2622668
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 唯一用户数: 27285
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 唯一视频数: 7583
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 训练用户数: 21828
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 验证用户数: 5457
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 点击率: 0.3314
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [数据统计] 平均播放时长: 15676.54ms
2025-08-03 12:56:21 - libs.modes.global_mode - INFO - [特征处理] 开始特征预处理...
2025-08-03 12:56:21 - libs.data.feature_processor - INFO - [特征处理] 开始特征拟合和转换...
2025-08-03 12:56:21 - libs.data.feature_processor - INFO - [特征处理] 处理缺失值...
2025-08-03 12:56:22 - libs.data.feature_processor - INFO - [特征处理] video_duration: 用0填充 65794 个缺失值
2025-08-03 12:56:22 - libs.data.feature_processor - INFO - [特征处理] onehot_feat4: 用0填充 89845 个缺失值
2025-08-03 12:56:22 - libs.data.feature_processor - INFO - [特征处理] onehot_feat12: 用0填充 59024 个缺失值
2025-08-03 12:56:22 - libs.data.feature_processor - INFO - [特征处理] onehot_feat13: 用0填充 59024 个缺失值
2025-08-03 12:56:22 - libs.data.feature_processor - INFO - [特征处理] onehot_feat14: 用0填充 59024 个缺失值
2025-08-03 12:56:23 - libs.data.feature_processor - INFO - [特征处理] onehot_feat15: 用0填充 59024 个缺失值
2025-08-03 12:56:23 - libs.data.feature_processor - INFO - [特征处理] onehot_feat16: 用0填充 59024 个缺失值
2025-08-03 12:56:23 - libs.data.feature_processor - INFO - [特征处理] onehot_feat17: 用0填充 59024 个缺失值
2025-08-03 12:56:23 - libs.data.feature_processor - INFO - [特征处理] tag: 将 28107 个缺失值标记为'MISSING'
2025-08-03 12:56:23 - libs.data.feature_processor - INFO - [特征处理] 缺失值处理完成
2025-08-03 12:56:23 - libs.data.feature_processor - INFO - [特征处理] 处理分类特征...
2025-08-03 12:56:24 - libs.data.feature_processor - INFO - [特征处理] user_active_degree: 9 个唯一值
2025-08-03 12:56:26 - libs.data.feature_processor - INFO - [特征处理] user_active_degree -> 9 个one-hot特征
2025-08-03 12:56:26 - libs.data.feature_processor - INFO - [特征处理] video_type: 3 个唯一值
2025-08-03 12:56:27 - libs.data.feature_processor - INFO - [特征处理] video_type -> 3 个one-hot特征
2025-08-03 12:56:27 - libs.data.feature_processor - INFO - [特征处理] tag: 111 个唯一值
2025-08-03 12:56:28 - libs.data.feature_processor - INFO - [特征处理] tag -> 111 个one-hot特征
2025-08-03 12:56:28 - libs.data.feature_processor - INFO - [特征处理] 分类特征处理完成，总维度: 123
2025-08-03 12:56:28 - libs.data.feature_processor - INFO - [特征处理] 处理数值特征...
2025-08-03 12:56:29 - libs.data.feature_processor - WARNING - [特征处理] 缺失的数值特征: ['follow_user_num']
2025-08-03 12:56:30 - libs.data.feature_processor - INFO - [特征处理] 数值特征标准化器已拟合，特征数: 34
2025-08-03 12:56:31 - libs.data.feature_processor - INFO - [特征处理] 数值特征标准化完成，维度: 34
2025-08-03 12:56:31 - libs.data.feature_processor - INFO - [特征处理] 特征处理完成，总维度: 157 (数值: 34, 分类: 123)
2025-08-03 12:56:31 - libs.data.feature_processor - INFO - [特征处理] 数据类型转换完成
2025-08-03 12:56:31 - libs.modes.global_mode - INFO - [特征处理] 特征维度: 157
2025-08-03 12:56:31 - libs.modes.global_mode - INFO - [特征处理] 特征列: ['video_duration', 'server_width', 'server_height', 'show_cnt', 'play_cnt', 'play_user_num', 'complete_play_cnt', 'like_cnt', 'comment_cnt', 'share_cnt', 'collect_cnt', 'is_live_streamer', 'is_video_author', 'fans_user_num', 'friend_user_num', 'register_days', 'onehot_feat0', 'onehot_feat1', 'onehot_feat2', 'onehot_feat3', 'onehot_feat4', 'onehot_feat5', 'onehot_feat6', 'onehot_feat7', 'onehot_feat8', 'onehot_feat9', 'onehot_feat10', 'onehot_feat11', 'onehot_feat12', 'onehot_feat13', 'onehot_feat14', 'onehot_feat15', 'onehot_feat16', 'onehot_feat17', 'user_active_degree_2_14_day_new', 'user_active_degree_30day_retention', 'user_active_degree_UNKNOWN', 'user_active_degree_day_new', 'user_active_degree_full_active', 'user_active_degree_high_active', 'user_active_degree_low_active', 'user_active_degree_middle_active', 'user_active_degree_single_low_active', 'video_type_AD', 'video_type_NORMAL', 'video_type_UNKNOWN', 'tag_1', 'tag_1,62', 'tag_10', 'tag_10,60', 'tag_11', 'tag_11,60', 'tag_12', 'tag_12,54', 'tag_12,54,60', 'tag_12,60', 'tag_12,62', 'tag_12,62,42', 'tag_12,62,60', 'tag_12,65', 'tag_12,65,60', 'tag_13', 'tag_13,62', 'tag_13,65', 'tag_14', 'tag_15', 'tag_15,67', 'tag_16', 'tag_17', 'tag_18', 'tag_19', 'tag_2', 'tag_20', 'tag_20,43', 'tag_20,54', 'tag_20,67', 'tag_20,67,68', 'tag_20,68', 'tag_21', 'tag_22', 'tag_23', 'tag_24', 'tag_25', 'tag_25,54', 'tag_25,65', 'tag_25,67', 'tag_26', 'tag_26,62', 'tag_26,65', 'tag_26,67', 'tag_27', 'tag_27,42', 'tag_27,42,54', 'tag_27,54', 'tag_27,67', 'tag_28', 'tag_29', 'tag_3', 'tag_3,42', 'tag_3,62', 'tag_3,62,42', 'tag_3,67', 'tag_30', 'tag_34', 'tag_35', 'tag_36', 'tag_37', 'tag_38', 'tag_39', 'tag_39,43', 'tag_39,68', 'tag_39,9', 'tag_4', 'tag_40,39', 'tag_42,18', 'tag_42,4', 'tag_42,60,18', 'tag_5', 'tag_5,42', 'tag_5,42,60', 'tag_5,54', 'tag_5,65', 'tag_5,65,42', 'tag_5,67', 'tag_56,39', 'tag_6', 'tag_62,10,60', 'tag_62,16', 'tag_62,18', 'tag_62,2', 'tag_62,27', 'tag_62,27,42', 'tag_62,4', 'tag_62,42,18', 'tag_62,42,4', 'tag_62,5', 'tag_62,5,42', 'tag_62,65,4', 'tag_62,7', 'tag_65,11', 'tag_65,18', 'tag_65,27,42', 'tag_65,36', 'tag_65,4', 'tag_65,42,18', 'tag_67,11', 'tag_67,19', 'tag_67,34', 'tag_67,4', 'tag_67,6', 'tag_67,7', 'tag_68,6', 'tag_7', 'tag_8', 'tag_8,67', 'tag_9', 'tag_MISSING']
2025-08-03 12:56:31 - libs.models.multi_label_model - INFO - [模型构建] 开始构建多标签预测模型...
2025-08-03 12:56:31 - libs.models.multi_label_model - INFO - [模型构建] 构建 play_time 模型...
2025-08-03 12:56:33 - libs.models.multi_label_model - INFO - [模型构建] play_time 模型: 30593 参数
2025-08-03 12:56:33 - libs.models.multi_label_model - INFO - [模型构建] 构建 click 模型...
2025-08-03 12:56:33 - libs.models.multi_label_model - INFO - [模型构建] click 模型: 12737 参数
2025-08-03 12:56:33 - libs.models.multi_label_model - INFO - [模型构建] 多标签模型构建完成，共 2 个模型
2025-08-03 12:56:33 - libs.modes.global_mode - INFO - [Global模式] 数据准备完成
2025-08-03 12:56:33 - libs.modes.global_mode - INFO - [预训练] 开始预训练阶段...
2025-08-03 12:56:36 - libs.modes.global_mode - INFO - [预训练] 训练数据量: 2090206
2025-08-03 12:56:36 - libs.modes.global_mode - INFO - [预训练] Epoch 1/10
2025-08-03 13:17:08 - libs.modes.global_mode - INFO - [预训练] Epoch 1 平均损失 - play_time: 3.151971, click: 0.596940
2025-08-03 13:17:09 - libs.modes.global_mode - INFO - [预训练] Epoch 2/10
2025-08-03 13:37:45 - libs.modes.global_mode - INFO - [预训练] Epoch 2 平均损失 - play_time: 2.981751, click: 0.585755
2025-08-03 13:37:45 - libs.modes.global_mode - INFO - [预训练] Epoch 3/10
2025-08-03 13:58:21 - libs.modes.global_mode - INFO - [预训练] Epoch 3 平均损失 - play_time: 2.976501, click: 0.581834
2025-08-03 13:58:21 - libs.modes.global_mode - INFO - [预训练] Epoch 4/10
2025-08-03 14:18:58 - libs.modes.global_mode - INFO - [预训练] Epoch 4 平均损失 - play_time: 2.972762, click: 0.579538
2025-08-03 14:18:58 - libs.modes.global_mode - INFO - [预训练] Epoch 5/10
2025-08-03 14:39:25 - libs.modes.global_mode - INFO - [预训练] Epoch 5 平均损失 - play_time: 2.970109, click: 0.578050
2025-08-03 14:39:25 - libs.modes.global_mode - INFO - [预训练] Epoch 6/10
